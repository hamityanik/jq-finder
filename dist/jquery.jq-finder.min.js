"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _iterableToArrayLimit(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,a,r=[],s=!0,o=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){o=!0,a=t}finally{try{s||null==n.return||n.return()}finally{if(o)throw a}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(s){function n(t,e){this.defaults={placeholder:"Choose a file",popoverTitle:"Browse Directory",browseBtn:null,connector:"connector.php",initialPath:"",contentWidth:400,contentHeight:300,contentMinHeight:null,contentMaxHeight:null,easing:null,speed:300,autoHide:!0,readOnly:!1,extensionsOnly:null,allowFileSelectOnly:!0,colorizeByExtension:!1,queryString:{},leadingSlash:!1,directoryTrailingSlash:!0,folderIcon:"fa fa-folder",folderIconOpen:"fa fa-folder-open",fileIcons:{".html":"fab fa-html5",".js":"fab fa-js-square",".png":"fa fa-image",".gif":"fa fa-image",".jpg":"fa fa-image",".webp":"fa fa-image",".avif":"fa fa-image",".mp4":"fa fa-film",".webm":"fa fa-film",".ogv":"fa fa-film",".css":"fab fa-css3",".ico":"fa fa-icons",".pdf":"fa fa-file-pdf",".txt":"fa fa-file-alt",".json":"fa fa-code"}},this.opts=s.extend({},this.defaults,e),this.$el=s(t),this.currentPane=null,this.pathBag=[],this.params={preventClicks:!1,selectionMade:!1,inputHeight:0,elOffsetX:0,elOffsetY:0,paneDepth:0,firstInit:!1}}n.prototype={init:function(){var e=this,t=e.$el.val();e.$el.attr("placeholder",this.opts.placeholder),e.opts.readOnly&&e.$el.prop("readonly",!0),""!==t&&(e.params.selectionMade=!0),null===e.opts.easing||s.easing&&s.easing.hasOwnProperty(e.opts.easing)||(console.warn('jq-finder: Easing method "'+e.opts.easing+'" is not available. Make sure that the jquery.easing plugin is included on the page.'),e.opts.easing=null),null===this.opts.browseBtn?e.$el.focus(function(){e.start()}).click(function(t){t.stopPropagation()}):s(this.opts.browseBtn).click(function(t){t.stopPropagation(),e.start()}),s("html").click(function(){e.hidePopover()}),s(window).resize(function(){e.hidePopover()})},start:function(){var n=this;this.popoverObj?(this.showPopover(),this.printPath()):(this.createPopover(),this.showSpinner(),this.loadPath(this.processPath(this.$el.val()||this.opts.initialPath),function(t,e){t=n.processData(t);n.increasePath(e),n.createPane(t,"r"),n.hideSpinner(),n.setNavigationBtn()}))},createPopover:function(){var e=this;e.popoverObj=s('<div class="jq-finder-popover"><div class="arrow"></div><div class="jq-finder-popover-header"><h3 class="jq-finder-popover-title">'+e.opts.popoverTitle+'</h3><a class="jq-finder-popover-close"><span class="fa fa-times-circle"></a></div><div class="jq-finder-popover-toolbar"><div class="jq-finder-popover-tools"><div class="btn-group btn-group-sm"><button class="btn btn-primary btn-sm jq-finder-back"><span class="fa fa-arrow-circle-left"></span> Back</button><button class="btn btn-primary btn-sm jq-finder-forward"><span class="fa fa-arrow-circle-right"></span></button></div></div><div class="jq-finder-popover-filter"><input class="form-control form-control-sm jq-finder-filter" placeholder="Filter items" type="text"></div></div><div class="jq-finder-popover-body"></div><div class="jq-finder-popover-footer"><div class="jq-finder-popover-status"></div><div><span id="loading-spinner" style="display: none" class="fa fa-spinner fa-spin"></span></div></div></div>').hide(),e.jqContent=s("<div>").addClass("jq-finder-content-container").html('<div class="jq-finder-init">Initializing...</div>'),e.popoverObj.click(function(t){t.stopPropagation()}).find(".jq-finder-popover-body").css({width:e.opts.contentWidth,height:e.opts.contentHeight,minHeight:e.opts.contentMinHeight,maxHeight:e.opts.contentMaxHeight}).html(e.jqContent),e.closeBtn=e.popoverObj.find("a.jq-finder-popover-close").click(function(t){t.preventDefault(),e.hidePopover()}),e.backBtn=e.popoverObj.find(".jq-finder-back").click(function(t){t.preventDefault(),e.params.preventClicks||e.prevDir()}),e.fwdBtn=e.popoverObj.find(".jq-finder-forward").prop("disabled",!0).click(function(t){t.preventDefault(),e.params.preventClicks||e.fwdPane()}),s("body").append(e.popoverObj),e.showPopover()},showPopover:function(){s(".jq-finder-instance").each(function(){var t=s(this).data("jq-finder");t.$el.is(":focus")||t.hidePopover()});var t=this.popoverObj.children(".arrow").height(),e=this.$el.offset();this.params.elOffsetX=e.left,this.params.elOffsetY=e.top,this.params.inputHeight=this.$el.outerHeight(),this.popoverObj.stop().css({top:this.params.elOffsetY+this.params.inputHeight,left:this.params.elOffsetX}).show().animate({top:this.params.elOffsetY+t+this.params.inputHeight+"px",opacity:1},200)},hidePopover:function(){this.popoverObj&&!this.popoverObj.is(":hidden")&&(this.params.selectionMade||this.$el.val(""),this.$el.blur(),this.popoverObj.stop().animate({top:this.params.elOffsetY+this.params.inputHeight,opacity:0},200,function(){s(this).hide()}))},loadPath:function(e,n){var i=this,t=this.getPath(e);s.ajax({url:this.opts.connector,data:{path:t},dataType:"json"}).done(function(t){!t.status.isDir&&t.status.isFile?i.loadPath(t.status.dirname,n):n(t,e)})},showSpinner:function(){this.popoverObj.find("#loading-spinner").show()},hideSpinner:function(){var t=this;setTimeout(function(){t.popoverObj.find("#loading-spinner").hide()},250)},increasePath:function(t){var e=this;t&&"/"!==t&&t.split("/").filter(function(t){return t}).forEach(function(t){e.pathBag.push(t)})},decreasePath:function(){this.pathBag.length&&this.pathBag.pop()},getCurrentPath:function(){return this.pathBag.join("/")},getCurrentPathLevel:function(){return this.pathBag.length},getPath:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return[e=null===e?this.getCurrentPath():e,t].filter(function(t){return t}).join("/")},getPrevPath:function(){return this.hasPath()?this.pathBag.slice(0,-1).join("/"):""},hasPath:function(){return this.pathBag.length&&1},processPath:function(t){return _slicedToArray(t.split("?"),1)[0].split("/").filter(function(t){return t}).join("/")},getBasenameFromPath:function(t){return t.split("/").pop()},processData:function(t){var a=this,r=s("<ul></ul>").css({width:a.opts.contentWidth}).data("status",t.status);return s.each(t.directories,function(t,e){r.append('<li><a href="#" data-child-dir="'+e+'"><span class="'+a.opts.folderIcon+'"></span>'+e+"</a></li>")}),s.each(t.files,function(t,e){var n=e.slice(e.lastIndexOf(".")),i=a.opts.fileIcons[n]||"fa fa-file";null===a.opts.extensionsOnly||-1<s.inArray(n,a.opts.extensionsOnly)?(n=a.opts.colorizeByExtension?' style="color: '+a.stringToColour(n)+'"':"",r.append('<li><a href="#" data-file="'+e+'"'+n+'><span class="'+i+'"></span>'+e+"</a></li>")):r.append('<li><a href="#" class="disabled"><span class="'+i+'"></span>'+e+"</a></li>")}),a.opts.allowFileSelectOnly||r.prepend('<li><a href="#" data-dir="'+t.status.requestPath+'" title="Select current directory: '+t.status.requestPath+'"><span class="'+a.opts.folderIconOpen+'"></span>.</a></li>'),0===t.status.itemCount&&r.append('<li class="jq-finder-dir-empty">Directory empty</li>'),void 0!==t.status.exception&&r.append('<li class="jq-finder-exception">'+t.status.exception+"</li>"),r.find("a").click(function(t){t.preventDefault(),a.params.preventClicks||s(this).hasClass("disabled")||((t=s(this).data("child-dir"))&&a.nextDir(t),(t=s(this).data("file"))&&a.selectFile(t),void 0!==(t=s(this).data("dir"))&&a.selectDir(t))}),r},nextDir:function(t){var n=this;if(this.params.preventClicks=!0,n.currentPane){var e=n.currentPane.next();if(e.length){if(e.data("path")===n.getPath(t))return n.currentPane=e,n.increasePath(t),void n.increasePaneDepth();n.currentPane.nextAll().remove()}}n.showSpinner(),n.loadPath(t,function(t,e){t=n.processData(t);n.increasePath(e),n.createPane(t,"r"),n.hideSpinner()})},prevDir:function(){var e=this;0<this.getCurrentPathLevel()&&(this.params.preventClicks=!0,this.currentPane.prev().length?(this.decreasePath(),this.decreasePaneDepth()):this.getCurrentPath()===this.opts.initialPath?this.params.preventClicks=!1:(this.showSpinner(),this.decreasePath(),this.loadPath("",function(t){t=e.processData(t);e.createPane(t,"l"),e.hideSpinner()})))},fwdPane:function(){var t=this.currentPane.next();t.length&&this.nextDir(this.getBasenameFromPath(t.data("path")))},createPane:function(t,e){this.jqContent.children(".jq-finder-init").remove();var n=s("<div>").addClass("jq-finder-content-pane").data("path",this.getCurrentPath()).hide().append(t);switch(e){case"r":this.currentPane=n,this.jqContent.append(this.currentPane),this.increasePaneDepth();break;case"l":this.jqContent.prepend(n),this.decreasePaneDepth()}},increasePaneDepth:function(){var t=this;t.params.firstInit?(this.setNavigationBtn(),t.currentPane.show(),t.jqContent.animate({left:"-"+t.opts.contentWidth+"px"},t.opts.speed,t.opts.easing,function(){t.currentPane.prev().removeClass("jq-finder-active-pane").hide(),t.jqContent.css({left:0}),t.createPaneCallback()})):(t.createPaneCallback(),t.params.firstInit=!0)},createPaneCallback:function(){this.currentPane.show().addClass("jq-finder-active-pane"),this.printPath(),this.updateItemsCount(),this.attachFilter(),this.contentScrollTop(),this.params.preventClicks=!1},decreasePaneDepth:function(){var t=this,e=t.currentPane.removeClass("jq-finder-active-pane").prev().show();t.jqContent.css({left:"-"+t.opts.contentWidth+"px"}).animate({left:0},t.opts.speed,t.opts.easing,function(){t.currentPane.hide(),t.currentPane=e.addClass("jq-finder-active-pane"),t.printPath(),t.updateItemsCount(),t.attachFilter(),t.contentScrollTop(),t.setNavigationBtn(),t.params.preventClicks=!1})},updateItemsCount:function(){this.popoverObj.find(".jq-finder-popover-status").text(this.jqContent.find(".jq-finder-active-pane ul").data("status").itemCount+" items")},printPath:function(){this.params.selectionMade||this.setElementVal(this.getCurrentPath())},selectFile:function(t){t=(this.hasPath()?this.getCurrentPath()+"/":"")+t;this.setElementVal(t),this.params.selectionMade=!0,this.opts.autoHide&&this.hidePopover(),this.$el.trigger("jq-finder-select",{type:"file",path:t})},selectDir:function(t){this.setElementVal(t,!0),this.params.selectionMade=!0,this.opts.autoHide&&this.hidePopover(),this.$el.trigger("jq-finder-select",{type:"dir",path:t})},setElementVal:function(t){var e="";1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&t&&this.opts.directoryTrailingSlash&&(e+="/"),"string"==typeof this.opts.queryString?e+=this.opts.queryString:s.isEmptyObject(this.opts.queryString)||(e+="?"+s.param(this.opts.queryString)),this.$el.val((this.opts.leadingSlash?"/":"")+t+e)},attachFilter:function(){var e=this;e.popoverObj.find(".jq-finder-content-pane ul li").show(),e.popoverObj.find(".jq-finder-filter").val("").off("keyup").on("keyup",function(){var t=s(this).val().toLowerCase();e.popoverObj.find(".jq-finder-active-pane ul li").filter(function(){s(this).toggle(-1<s(this).text().toLowerCase().indexOf(t))})})},contentScrollTop:function(){this.jqContent.parent().animate({scrollTop:0},200,this.opts.easing)},stringToColour:function(t){for(var e=0,n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);for(var i="#",a=0;a<3;a++){var r="00"+(e>>8*a&255).toString(16);i+=r.substring(r.length-2)}return i},setNavigationBtn:function(){this.backBtn.prop("disabled",!(0<this.getCurrentPathLevel())),this.fwdBtn.prop("disabled",!(0<this.currentPane.next().length))}},s.fn.jqFinder=function(e){return this.length&&this.each(function(){var t=new n(this,e);t.init(),s(this).addClass("jq-finder-instance").data("jq-finder",t)}),this}}(jQuery);
//# sourceMappingURL=jquery.jq-finder.min.js.map
